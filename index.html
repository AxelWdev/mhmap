<!DOCTYPE html>
<html>
  <head>
    <title>Interactive Map</title>
    <style>
      body {
        background-color: black;
        margin: 0;
        padding: 0;
      }

      #map-container {
        position: relative;
        width: 640px;
        height: 2807px; 
        margin: auto;
      }

      #map {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url('map.jpg');
        background-size: cover;
      }

      .timer-container {
        position: absolute;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: red;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0.60;
      }

      .timer {
        font-size: 12px;
        color: white;
      }

      .respawned {
        font-size: 10px;
      }

      .delete-button {
        position: absolute;
        top: -5px;
        right: -5px;
        width: 16px;
        height: 16px;
        border: none;
        background-color: red;
        color: white;
        font-weight: bold;
        font-size: 12px;
        cursor: pointer;
        border-radius: 50%;
      }
    </style>
  </head>
  <body>
    <div id="map-container">
      <div id="map"></div>
    </div>

   <script>
  function addTimer(event) {
  let targetDate;
  const x = event.clientX - event.target.getBoundingClientRect().left;
  const y = event.clientY - event.target.getBoundingClientRect().top;

  if (y < 556) { // check if the timer is placed above a chosen y position
    targetDate = new Date().getTime() + 14100000; // 3 55  from now for Tibet 
  } else { // otherwise, set targetDate to 3 hours and 42 minutes from now
    targetDate = new Date().getTime() + 13320000;
  }

  const container = document.createElement('div');
  container.classList.add('timer-container');
  container.style.top = `${y - 20}px`;
  container.style.left = `${x - 20}px`;

  const timer = document.createElement('div');
  timer.classList.add('timer');
  container.appendChild(timer);

  const deleteButton = document.createElement('button');
  deleteButton.innerHTML = 'x';
  deleteButton.classList.add('delete-button');
  deleteButton.addEventListener('click', (event) => {
    event.stopPropagation(); // stop the event from propagating up the DOM tree
    localStorage.removeItem(`timer-${targetDate}`); // remove from localStorage
    container.remove();
  });
  container.appendChild(deleteButton);

  document.getElementById('map').appendChild(container);

  localStorage.setItem(`timer-${targetDate}`, JSON.stringify({
    targetDate,
    position: { x, y }
  })); // update localStorage

  const countdown = setInterval(() => {
    const now = new Date().getTime();
    const distance = targetDate - now;
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
    timer.innerHTML = `${hours}:${minutes  < 10 ? '0' : '' }${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    if (distance < 0) {
      clearInterval(countdown);
      timer.innerHTML = 'Respawned';
      timer.classList.add('respawned');
    }
  }, 1000);
}


  document.getElementById('map').addEventListener('click', addTimer);

  // restore timers from localStorage when the page loads
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith('timer-')) {
      const { targetDate, position } = JSON.parse(localStorage.getItem(key));
      const { x, y } = position;
      const container = document.createElement('div');
      container.classList.add('timer-container');
      container.style.top = `${y - 20}px`;
      container.style.left = `${x - 20}px`;

      const timer = document.createElement('div');
      timer.classList.add('timer');
      container.appendChild(timer);

      const deleteButton = document.createElement('button');
      deleteButton.innerHTML = 'x';
      deleteButton.classList.add('delete-button');
      deleteButton.addEventListener('click', (event) => {
        event.stopPropagation(); // stop the event from propagating up the DOM tree
        container.remove();
        localStorage.removeItem(`timer-${targetDate}`); // remove from localStorage
      });
      container.appendChild(deleteButton);

      document.getElementById('map').appendChild(container);

      const countdown = setInterval(() => {
        const now = new Date().getTime();
        const distance = targetDate - now;
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24))
/ (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        timer.innerHTML =`${hours}:${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        if (distance < 0) {
clearInterval(countdown);
timer.innerHTML = 'Respawned';
timer.classList.add('respawned'); 
}
}, 1000);
}
}
</script>

  </body>
</html>